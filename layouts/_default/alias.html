<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}">
<head>
    <meta charset="utf-8">
    <title>Redirecting...</title>
    
    {{- /* For alias pages, find the original page that has this alias */ -}}
    {{- $canonicalURL := "" -}}
    {{- $currentAlias := .RelPermalink -}}
    
    {{- /* First, try to use .Page if available (Hugo sometimes provides this) */ -}}
    {{- if .Page -}}
        {{- $canonicalURL = .Page.Permalink -}}
    {{- end -}}
    
    {{- /* If not found, search all pages for matching alias */ -}}
    {{- if not $canonicalURL -}}
        {{- range .Site.AllPages -}}
            {{- $page := . -}}
            {{- if and .Params.aliases -}}
                {{- range .Params.aliases -}}
                    {{- $aliasValue := . -}}
                    {{- /* Normalize both paths for comparison - handle with and without leading/trailing slashes */ -}}
                    {{- $aliasClean := $aliasValue | strings.TrimSuffix "/" | strings.TrimPrefix "/" -}}
                    {{- $currentClean := $currentAlias | strings.TrimSuffix "/" | strings.TrimPrefix "/" -}}
                    {{- /* Try exact match first, then normalized match */ -}}
                    {{- if or (eq $aliasValue $currentAlias) (eq $aliasClean $currentClean) -}}
                        {{- $canonicalURL = $page.Permalink -}}
                        {{- break -}}
                    {{- end -}}
                {{- end -}}
            {{- end -}}
            {{- if $canonicalURL -}}
                {{- break -}}
            {{- end -}}
        {{- end -}}
    {{- end -}}
    
    {{- /* Fallback: if redirectTo is specified, use it */ -}}
    {{- if and (not $canonicalURL) .Params.redirectTo -}}
        {{- $canonicalURL = .Params.redirectTo -}}
    {{- end -}}
    
    {{- /* Ensure we have a URL and make it absolute */ -}}
    {{- if not $canonicalURL -}}
        {{- $canonicalURL = .Site.BaseURL -}}
    {{- end -}}
    
    {{- $baseURL := .Site.BaseURL | strings.TrimSuffix "/" -}}
    {{- if not (hasPrefix $canonicalURL "http") -}}
        {{- $canonicalURL = printf "%s%s" $baseURL ($canonicalURL | strings.TrimPrefix "/") -}}
    {{- end -}}
    
    <!-- Canonical link: Tells search engines this is a PERMANENT redirect (301 equivalent) -->
    <!-- This is the key for SEO - Google will update their index to the new URL -->
    <link rel="canonical" href="{{ $canonicalURL }}">
    
    <!-- Meta refresh for immediate redirect (0 seconds) -->
    <meta http-equiv="refresh" content="0; url={{ $canonicalURL }}">
    
    <!-- SEO: Tell search engines to follow the redirect but not index this redirect page -->
    <meta name="robots" content="noindex, follow">
    
    <!-- JavaScript redirect as fallback (using replace = no history entry, like 301) -->
    <script>
        // window.location.replace() doesn't add to history (like a 301 redirect)
        window.location.replace("{{ $canonicalURL }}");
    </script>
</head>
<body>
    <p>If you are not redirected automatically, <a href="{{ $canonicalURL }}">click here</a>.</p>
</body>
</html>

